
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
    
    
    
    
    <title>慕课网-前端性能优化企业级解决方案 6大角度+大厂视野实现项目全面优化 | 彭友谊的博客</title>


    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="pengyouyi">
    

    
    <!--<%- open_graph({twitter_id: theme.author.twitter, google_plus: theme.author.google_plus}) %>-->

    <meta name="description" content="page.description">
    
    <meta property="og:type" content="article">
    
    <meta property="og:title" content="慕课网-前端性能优化企业级解决方案 6大角度+大厂视野实现项目全面优化">
    <meta property="og:url" content="/other/2020/12/02/muke-performance-optimization">
    <meta property="og:site_name" content="彭友谊的博客">
    <meta property="og:description" content="慕课网-前端性能优化企业级解决方案 6大角度+大厂视野实现项目全面优化">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="慕课网-前端性能优化企业级解决方案 6大角度+大厂视野实现项目全面优化">
    <meta name="twitter:description" content="page.description">
    <meta name="twitter:creator" content="@">

  <!-- <meta name="baidu-site-verification" content="omJRdVnwTK" /> -->
  <meta name="baidu-site-verification" content="BCTXxB6hux" />

    <link rel="publisher" href="">

    
    
    <link rel="icon" href="/assets/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/assets/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/assets/img/jacman.jpg">
    

    <link rel="stylesheet" href="/assets/css/style.css" type="text/css">
    <link rel="stylesheet" href="/assets/css/highlight.css" type="text/css">
</head>

<!--  flagcounter   -->

<!--<a href="http://info.flagcounter.com/Q6yu"><img src="http://s10.flagcounter.com/count2/Q6yu/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_10/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a>-->



<!--百度站内搜索开始
<script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=6765244687647673409' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>


<div id="bdcs-frame-box"></div>
<script type="text/javascript">
  var bdcsFrameSid="6765244687647673409";
  var bdcsFrameWidth = 552;
  var bdcsFrameWt = 1;
  var bdcsFrameHt = 1;
  var bdcsFrameResultNum = 10;
  var bdcsFrameBgColor = "#ffffff";
</script>
<script type="text/javascript" src="http://zhannei.baidu.com/static/js/iframe.js"></script>

百度站内搜索结束-->

<!--百度站内搜索开始  彭友谊好好 - 18233560490  -->
<script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=9872709389462059831' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>
<!--百度站内搜索结束  http://zn.baidu.com/cse/searchbox/index?sid=9872709389462059831  -->


<!-- target=blank  -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    //为超链接加上target='_blank'属性
    $('a[href^="http"]').each(function() {
      $(this).attr('target', '_blank');
    });
  });
</script>

  <body>
    <header>
        <div>
		    
			<div id="imglogo">
				<a href="/"><img src="/assets/img/logo.png" alt="彭友谊的博客" title="彭友谊的博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="彭友谊的博客">彭友谊的博客</a></h1>
				<h2 class="blog-motto">努力做好一名前端攻城狮</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="menu">
			</a></div>
	<!-----  flagcounter   ----->
	<!--<a href="http://info.flagcounter.com/Q6yu" target="_blank" style="position: absolute;right: 0;"><img src="http://s10.flagcounter.com/count2/Q6yu/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_10/viewers_0/labels_1/pageviews_1/flags_0/percent_0/" alt="Flag Counter" border="0"></a>-->
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
						<!-- <form class="search" action="http://pengyouyi.site" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= 9872709389462059831 >
							<input type="text" name="q" size="30" placeholder="搜索"><br>
						</form> -->
					
					</li>
				</ul>
			</nav>	
</div>





    </header>
    <div id="container">
      


<div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
	<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/other/2020/12/02/muke-performance-optimization" title="慕课网-前端性能优化企业级解决方案 6大角度+大厂视野实现项目全面优化" itemprop="url">慕课网-前端性能优化企业级解决方案 6大角度+大厂视野实现项目全面优化</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="pengyouyi" target="_blank" itemprop="author">pengyouyi</a>
		
  <p class="article-time">
    <time datetime="2020-12-02 00:00:00 +0800" itemprop="datePublished"> 发表于 2020-12-02</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article toc-content">
		
			<!--<%- toc(item.content) %>-->
		
		</div>
		
		<h1 id="2-two">第2章 性能优化的指标和工具-two</h1>

<h2 id="why-web">why 为什么要进行Web性能优化【企业刚需】</h2>

<p>性能 - Web 网站和应用的支柱</p>

<p>流量 - 搜索 - 转换率 - 用户体验</p>

<p>阅读：Amazon 发现每 100ms 延迟导致 1% 的销量损失</p>

<p><strong>寻找性能瓶颈</strong></p>

<ul>
<li>了解性能指标 - 多快才算快<br></li>
<li>利用测量工具和APIs<br></li>
<li>优化问题，重新测量（迭代）<br></li>
</ul>

<p><strong>移动端挑战多</strong></p>

<ul>
<li>设备硬件，网速，屏幕尺寸，交互方式<br></li>
<li>用户缺少耐心，&gt;3秒加载导致53%的跳出率（bounce rate）<br></li>
<li>持续增长的移动用户和移动电商业务<br></li>
</ul>

<h2 id="index">性能指标和优化目标-index【了解行业标准】</h2>

<p>chrome 浏览器 检查中的 <code>Network、Lighthouse 、Performace</code></p>

<p>优化所有的异步请求在1秒内返回，可以做压缩，如果还不行，就需要前端交互，比如做加载动画。</p>

<p>性能优化 - 加载</p>

<ul>
<li>理解加载瀑布图【Network-Waterfall】<br></li>
<li>基于 HAR 存储于重建性能信息<br></li>
<li>速度指数（Lighthouse - Speed Index）【4s】<br></li>
<li>重要测量指标<br></li>
</ul>

<p>性能优化 - 加载</p>

<ul>
<li>Speed Index【Lighthouse - Speed Index (4s)】<br></li>
<li>TTFB【Waterfall-Waiting】<br></li>
<li>页面加载时间【Waterfall-Load 红线】<br></li>
<li>首次渲染【Lighthouse - First Contentful Paint】<br></li>
</ul>

<p>性能优化 - 响应</p>

<ul>
<li>交互动作的反馈时间<br></li>
<li>动画帧率 FPS<br></li>
<li>异步请求的完成时间<br></li>
</ul>

<h2 id="rail">RAIL 测量模型【黄金指南】</h2>

<p><strong>什么是 RAIL ？</strong></p>

<ul>
<li>Response 响应【网站给用户的响应体验】 </li>
<li>Animation 动画<br></li>
<li>Idle 空闲【让浏览器有足够的空闲时间】<br></li>
<li>Load 加载【用户白屏时间】</li>
</ul>

<p><strong>RAIL 的目标</strong></p>

<p>让良好的用户体验成为性能优化的目标  </p>

<p><strong>RAIL 评估标准</strong></p>

<ul>
<li>响应：处理事件应在50ms以内完成<br></li>
<li>动画：每10ms产生一帧<br></li>
<li>空闲：尽可能增加空闲时间<br></li>
<li>加载：在5s内完成内容加载并可以交互<br></li>
</ul>

<p><strong>性能测量工具</strong></p>

<ul>
<li>Chrome DevTools 开发调试、性能评测<br></li>
<li>Lighthouse 网站整体质量评估<br></li>
<li>WebPageTest 多测试地点、全面性能报告<br></li>
</ul>

<h2 id="webpagetest">WebPageTest 多测试地点、全面性能报告【快捷好用的在线分析工具】</h2>

<p><a href="https://webpagetest.org/">https://webpagetest.org/</a></p>

<p><strong>解读 WebpageTest 的报告</strong></p>

<ul>
<li>waterfall chart 请求瀑布图<br></li>
<li>first view 首次访问<br></li>
<li>repeat view 二次访问<br></li>
</ul>

<p><strong>WebPageTest</strong></p>

<ul>
<li>在线进行网站性能分析, WebPageTest 多测试地点、全面性能报告<br></li>
<li>如何本地部署 WebPageTest 工具<br></li>
</ul>

<h2 id="lighthouse">Lighthouse 网站整体质量评估【一站式全面呈现性能指标】</h2>

<h2 id="chrome-devtools">使用 Chrome DevTools 分析性能【最大法宝】</h2>

<p>Network<br>
 Performace</p>

<h2 id="apis">常用的性能测量 APIs【不可不知，打开精细化、自定义测量的大门】 </h2>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
    <span class="c1">// 计算一些关键的性能指标</span>
    <span class="c1">// load 事件后触发</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'load'</span><span class="p">,()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Time to Interactive 可交互时间</span>
        <span class="kd">let</span> <span class="nx">timing</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">getEntriesByType</span><span class="p">(</span><span class="s1">'navigation'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kd">let</span> <span class="nx">tti</span> <span class="o">=</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">domInteractive</span> <span class="o">-</span> <span class="nx">timing</span><span class="p">.</span><span class="nx">fetchStart</span><span class="p">;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"TTI: "</span> <span class="o">+</span> <span class="nx">diff</span><span class="p">);</span>
    <span class="p">})</span>
  <span class="o">&lt;</span><span class="nx">script</span><span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/html</span><span class="err">&gt;
</span></code></pre></div>
<p><strong>更多的性能指标如何计算</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">DNS</span> <span class="err">解析耗时:</span> <span class="nx">domainLookupEnd</span> <span class="o">-</span> <span class="nx">domainLookupStart</span>
<span class="nx">TCP</span> <span class="err">连接耗时:</span> <span class="nx">connectEnd</span> <span class="o">-</span> <span class="nx">connectStart</span>
<span class="nx">SSL</span> <span class="err">安全连接耗时:</span> <span class="nx">connectEnd</span> <span class="o">-</span> <span class="nx">secureConnectionStart</span>
<span class="err">网络请求耗时</span> <span class="p">(</span><span class="nx">TTFB</span><span class="p">)</span><span class="err">:</span> <span class="nx">responseStart</span> <span class="o">-</span> <span class="nx">requestStart</span>
<span class="err">数据传输耗时:</span> <span class="nx">responseEnd</span> <span class="o">-</span> <span class="nx">responseStart</span>
<span class="nx">DOM</span> <span class="err">解析耗时:</span> <span class="nx">domInteractive</span> <span class="o">-</span> <span class="nx">responseEnd</span>
<span class="err">资源加载耗时:</span> <span class="nx">loadEventStart</span> <span class="o">-</span> <span class="nx">domContentLoadedEventEnd</span>
<span class="nx">First</span> <span class="nx">Byte</span><span class="err">时间:</span> <span class="nx">responseStart</span> <span class="o">-</span> <span class="nx">domainLookupStart</span>
<span class="err">白屏时间:</span> <span class="nx">responseEnd</span> <span class="o">-</span> <span class="nx">fetchStart</span>
<span class="err">首次可交互时间:</span> <span class="nx">domInteractive</span> <span class="o">-</span> <span class="nx">fetchStart</span>
<span class="nx">DOM</span> <span class="nx">Ready</span> <span class="err">时间:</span> <span class="nx">domContentLoadEventEnd</span> <span class="o">-</span> <span class="nx">fetchStart</span>
<span class="err">页面完全加载时间:</span> <span class="nx">loadEventStart</span> <span class="o">-</span> <span class="nx">fetchStart</span>
<span class="nx">http</span> <span class="err">头部大小：</span> <span class="nx">transferSize</span> <span class="o">-</span> <span class="nx">encodedBodySize</span>
<span class="err">重定向次数：</span><span class="nx">performance</span><span class="p">.</span><span class="nx">navigation</span><span class="p">.</span><span class="nx">redirectCount</span>
<span class="err">重定向耗时:</span> <span class="nx">redirectEnd</span> <span class="o">-</span> <span class="nx">redirectStart</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// 观察长任务</span>
<span class="kr">const</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PerformanceObserver</span><span class="p">((</span><span class="nx">list</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">entry</span> <span class="nx">of</span> <span class="nx">list</span><span class="p">.</span><span class="nx">getEntries</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">({</span><span class="na">entryTypes</span><span class="p">:</span> <span class="p">[</span><span class="s1">'longtask'</span><span class="p">]})</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// 见面可见性的状态监听</span>
<span class="kd">let</span> <span class="nx">vEvent</span> <span class="o">=</span> <span class="s1">'visibilitychange'</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">webkitHidden</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// webkit prefix detected</span>
    <span class="nx">vEvent</span> <span class="o">=</span> <span class="s1">'webkitvisibilitychange'</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">visibilityChanged</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">hidden</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">webkitHidden</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Web page is hidden."</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Web page is visible."</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">vEvent</span><span class="p">,</span> <span class="nx">visibilityChanged</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// 网络状态</span>
<span class="kd">var</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">connection</span> <span class="o">||</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">mozConnection</span> <span class="o">||</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">webkitConnection</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">effectiveType</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">updateConnectionStatus</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Connection type changed from "</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s2">" to "</span> <span class="o">+</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">effectiveType</span><span class="p">);</span>
  <span class="nx">type</span> <span class="o">=</span> <span class="nx">connection</span><span class="p">.</span><span class="nx">effectiveType</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">connection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'change'</span><span class="p">,</span> <span class="nx">updateConnectionStatus</span><span class="p">);</span>
</code></pre></div>
<h1 id="3-three">第3章 渲染优化-three (与浏览器为友，共进退)</h1>

<h2 id="principle">浏览器渲染原理和关键渲染路径-principle【大厂前端面试必考】</h2>

<p><strong>浏览器的渲染流程</strong></p>

<p>JavaScript -&gt; Style -&gt; Layout -&gt; Paint -&gt; Composite</p>

<p>构建 DOM 对象<br>
HTML -&gt; DOM</p>

<p>构建 CSSOM 对象<br>
CSS -&gt; CSSOM</p>

<p>浏览器构建渲染树<br>
DOM + CSSOM = Render Tree</p>

<h2 id="thrashing">回流与重绘, 如何避免布局抖动-thrashing</h2>

<p><strong>布局（layouts）与绘制（paint）</strong></p>

<ul>
<li>渲染树只包含网页需要的节点<br></li>
<li>布局计算每个节点精确的位置和大小-“盒模型”<br></li>
<li>绘制是像素化每个节点的过程<br></li>
</ul>

<p><strong>影响回流的操作</strong></p>

<ul>
<li>添加/删除元素</li>
<li>display:none<br></li>
<li>移动元素位置<br></li>
<li>操作 styles<br></li>
<li>offsetLeft,scrollLeft,clientWidth<br></li>
<li>修改浏览器大小，字体<br></li>
</ul>

<p><strong>避免 layout thrashing 布局抖动</strong></p>

<ul>
<li>避免回流<br></li>
<li>读写分离</li>
</ul>

<h2 id="fastdom">使用 FastDom【防止布局抖动的利器】</h2>

<p><a href="https://github.com/wilsonpage/fastdom">https://github.com/wilsonpage/fastdom</a></p>

<p>使用 FastDOM 批量对 DOM 的读写操作 </p>

<ul>
<li>什么是 FastDom<br></li>
<li>如何使用 FastDom 的 APIs 【measure读、mutate写】</li>
</ul>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// 读</span>
<span class="nx">fastdom</span><span class="p">.</span><span class="nx">measure</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'measure'</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// 写</span>
<span class="nx">fastdom</span><span class="p">.</span><span class="nx">mutate</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'mutate'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">fastdom</span><span class="p">.</span><span class="nx">measure</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'measure'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">fastdom</span><span class="p">.</span><span class="nx">mutate</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'mutate'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>结果</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">measure</span>
<span class="nx">measure</span>
<span class="nx">mutate</span>
<span class="nx">mutate</span>
</code></pre></div>
<h2 id="layers">复合线程与图层-layers【深入渲染流水线的最后一站】</h2>

<p>复合线程（compositor thread）与图层（layers）</p>

<p><strong>复合线程做什么？</strong></p>

<ul>
<li>将页面拆分图层进行绘制再进行复合<br></li>
<li>利用 DevTools 了解网页的图层拆分情况<br></li>
<li>哪些样式仅影响复合<br></li>
</ul>

<p><strong>只触发复合，不触发布局和重绘 transform、opacity</strong></p>
<div class="highlight"><pre><code class="language-" data-lang="">Position  transform: translate(npx, npx)
Scale     transform: scale(n)
Rotation  transform: ratate(ndeg)
Opacity   opacity: 0...1
</code></pre></div>
<h2 id="repaint">避免重绘-repaint【必学，加速页面呈现】</h2>

<p><strong>减少重绘的方案</strong></p>

<ul>
<li>利用 DevTools 识别 paint 的瓶颈<br></li>
<li>利用 CSS 的 <code>will-change</code> 属性 创造新的图层<br></li>
<li>做动画的时候尽量使用 transform 而不是使用影响布局的 width 等<br></li>
</ul>

<h2 id="debounce">高频事件防抖-debounce【解救页面卡顿的秘药】</h2>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// 利用 Chrome DevTllos 打开时可以复现抖动的问题（pointer events）</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'pointermove'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
<span class="p">})</span>
</code></pre></div>
<p>防抖之后</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">let</span> <span class="nx">ticking</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'pointermove'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ticking</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="nx">ticking</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">pos</span><span class="p">);</span>
        <span class="nx">ticking</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">})</span> 
<span class="p">})</span>
</code></pre></div>
<h1 id="4-four">第4章 代码优化-four (快来看看怎样写出真正高性能的代码)</h1>

<h2 id="js-parsing-js">JS 开销和如何缩短解析时间-parsing【为什么我的JS运行慢】</h2>

<p><strong>JS 开销在哪里？</strong></p>

<ul>
<li>加载<br></li>
<li>解析 &amp; 编译<br></li>
<li>执行<br></li>
</ul>

<p><strong>解决方案</strong></p>

<ul>
<li>Code splitting 代码拆分，按需加载<br></li>
<li>Tree shaking 代码减重<br></li>
</ul>

<p><strong>减少主线程工作量</strong></p>

<ul>
<li>避免长任务<br></li>
<li>避免超过 1kb 的行间脚本<br></li>
<li>使用 RAF 和 rIC（requestIdleCallback） 进行时间调度<br></li>
</ul>

<p>★ 让用户知道开始访问网站的过程，减少白屏时间；<br><br>
★ 内容是不是有用的，加载一些文字或者图片；<br><br>
★ 什么时候可以开始交互了。  </p>

<h2 id="v8">配合 V8 有效优化代码【路走对了才能快】</h2>

<p><strong>v8 编译原理</strong></p>

<p>拿到JS代码 -&gt; 解析 -&gt; 抽象语法树 -&gt; 解释器 -&gt; 优化编译</p>

<p><strong>抽象语法树</strong></p>

<ul>
<li>源码 =&gt; 抽象语法树 =&gt; 字节码 Bytecode =&gt; 机器码<br></li>
<li>编译过程会进行优化<br></li>
<li>运行时可能发生反优化<br></li>
</ul>

<p><strong>V8 优化机制</strong></p>

<ul>
<li>脚本流（正常流程是先下载，解析，执行；优化：脚本大的时候，下载的过程中同时解析）<br></li>
<li>字节码缓存（使用频率高的缓存）<br></li>
<li>懒解析（函数声明了，但是没有马上用，用的时候浏览器才会去解析）<br></li>
</ul>

<p>保存文件，在Node环境下运行</p>
<div class="highlight"><pre><code class="language-" data-lang="">const {performance, PerformanceObserver} = require('perf_hooks');

const add = (a, b) =&gt; a+b;

const num1 = 1;
const num2 = 2;

performance.mark('start');

for(let i = 0; i &lt; 10000000; i++) {
    add(num1, num2);
}

add(num1, 's');

for(let i = 0; i &lt; 10000000; i++) {
    add(num1, num2);
}

performance.mark('end');

const observer = new PerformanceObserver((list) =&gt; {
    console.log(list.getEntries()[0]);
})
observer.observe({entryTypes: ['measure']});

performance.measure('测量1', 'start', 'end');
</code></pre></div>
<h2 id="function-optimization">函数优化-Function optimization【必会】</h2>

<p><strong>函数的解析方式</strong></p>

<ul>
<li>lazy parsing 懒解析 VS eager parsing 饥饿解析<br></li>
<li>利用 <a href="https://github.com/nolanlawson/optimize-js">Optimize.js</a> 优化初次加载时间<br></li>
</ul>

<p>test.js</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="k">default</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">add</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>  <span class="c1">// lazy parsing</span>
  <span class="c1">// const add = ((a, b) =&gt; a + b);  // 变成 饥饿解析的函数</span>
  <span class="kr">const</span> <span class="nx">num1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">num2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="nx">add</span><span class="p">(</span><span class="nx">num1</span><span class="p">,</span> <span class="nx">num2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="object-optimization-js">对象优化-Object optimization【JS对象避坑地图】</h2>

<p><strong>对象优化可以做哪些</strong></p>

<p>❶ 以相同顺序初始化对象成员，避免隐藏类的调整<br><br>
❷ 实例化后避免添加新属性<br><br>
❸ 尽量使用 Array 代替 array-like 对象<br><br>
❹ 避免读取超过数组从长度<br><br>
❺ 避免元素类型转换  </p>

<p><strong>以相同顺序初始化对象成员，避免隐藏类的调整</strong></p>

<p>good</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">class</span> <span class="nx">RectArea</span> <span class="p">{</span> <span class="c1">// HC0 </span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">w</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="nx">l</span><span class="p">;</span> <span class="c1">// HC1</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">w</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span> <span class="c1">// HC2</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">rect1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RectArea</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// 创建了隐藏类HC0, HC1, HC2</span>
<span class="kr">const</span> <span class="nx">rect2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RectArea</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span> <span class="c1">// 相同的对象结构，可复用之前的所有隐藏类</span>
</code></pre></div>
<p>bad</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">car1</span> <span class="o">=</span> <span class="p">{</span><span class="na">color</span><span class="p">:</span> <span class="s1">'red'</span><span class="p">};</span> <span class="c1">// HC0</span>
<span class="nx">car1</span><span class="p">.</span><span class="nx">seats</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// HC1</span>

<span class="kr">const</span> <span class="nx">car2</span> <span class="o">=</span> <span class="p">{</span><span class="na">seats</span><span class="p">:</span> <span class="mi">2</span><span class="p">};</span> <span class="c1">// 没有可复用的隐藏类，创建HC2</span>
<span class="nx">car2</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s1">'blue'</span><span class="p">;</span> <span class="c1">// 没有可复用的隐藏类，创建HC3</span>
</code></pre></div>
<p><strong>实例化后避免添加新属性</strong></p>

<p>bad</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">car1</span> <span class="o">=</span> <span class="p">{</span><span class="na">color</span><span class="p">:</span> <span class="s1">'red'</span><span class="p">};</span> <span class="c1">// In-object 属性</span>
<span class="nx">car1</span><span class="p">.</span><span class="nx">seats</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// Normal/Fast 属性，存储在property store里，需要通过描述数组间接查找 </span>
</code></pre></div>
<p><strong>尽量使用 Array 代替 array-like 对象</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arrObj</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// 不如在真实数组上效率高</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span> <span class="nx">index</span> <span class="p">}:</span> <span class="nx">$</span><span class="p">{</span> <span class="nx">value</span> <span class="p">}</span><span class="err">`</span><span class="p">);</span>
<span class="p">});</span>

<span class="kr">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arrObj</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// 转换的代价比影响优化小</span>
<span class="nx">arr</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">value</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span> <span class="nx">index</span> <span class="p">}:</span> <span class="nx">$</span><span class="p">{</span> <span class="nx">value</span> <span class="p">}</span><span class="err">`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p><strong>避免读取超过数组的长度</strong></p>

<p>bad</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 越界比较</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//  1.造成undefined与数进行比较 2.沿原型链的查找</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span> <span class="c1">// 业务上无效、出错</span>
    <span class="p">}</span>    
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>避免元素类型转换</strong></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span> <span class="c1">// PACKED_SMI_ELEMENTS</span>

<span class="nx">array</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="mf">4.4</span><span class="p">);</span> <span class="c1">// PACKED_DOUBLE_ELEMENTS</span>
</code></pre></div>
<h2 id="html">HTML 优化【必会】</h2>

<p><strong>HTML 优化也重要</strong></p>

<ul>
<li>减少 iframes 使用<br></li>
<li>压缩空白符<br></li>
<li>避免节点深层次级嵌套<br></li>
<li>避免 table 布局<br></li>
<li>删除注释<br></li>
<li>css &amp; js 尽量外链<br></li>
<li>删除元素默认属性<br></li>
</ul>

<p><strong>借助工具</strong></p>

<p>html-minifier  </p>

<h2 id="css">CSS 对性能的影响 【必会】</h2>

<ul>
<li>降低 CSS 对渲染的阻塞<br></li>
<li>利用 GPU 进行完成动画<br></li>
<li>使用 contain 属性  <code>contain: layout</code><br></li>
<li>字体使用 font-display 属性<br></li>
</ul>

<h1 id="5-five">第5章 资源优化-five (经典性能优化解决方案)</h1>

<h2 id="compress">资源的压缩与合并-compress【见效最明显的优化方法】</h2>

<p><strong>为什么要压缩 &amp; 合并</strong></p>

<ul>
<li>减少 HTTP 请求数量<br></li>
<li>减少请求资源的大小<br></li>
</ul>

<p><strong>HTML 压缩</strong></p>

<ul>
<li>使用在线工具进行压缩<br></li>
<li>使用 html-minifier 等 npm 工具<br></li>
</ul>

<p><strong>CSS 压缩</strong></p>

<ul>
<li>使用在线工具进行压缩<br></li>
<li>使用 clean-css 等 npm 工具<br></li>
</ul>

<p><strong>JS 压缩与混淆</strong></p>

<ul>
<li>使用在线工具进行压缩<br></li>
<li>使用 webpack 对 JS 在构建时压缩<br></li>
</ul>

<p><strong>css js 文件合并</strong></p>

<ul>
<li>若干小文件，maybe。。。<br></li>
<li>无冲突，服务相同的模块，OK<br></li>
<li>优化加载，NO<br></li>
</ul>

<h2 id="image">图片格式优化-image【多种图片格式，哪种最合适】</h2>

<p><strong>图片优化方案</strong></p>

<ul>
<li>图片格式<br></li>
<li>图片大小<br></li>
<li>适配不同屏幕的尺寸<br></li>
<li>压缩<br></li>
<li>资源优先级<br></li>
<li>延迟加载<br></li>
</ul>

<p><strong>图片格式</strong></p>

<p><strong>jpeg/jpg</strong></p>

<ul>
<li>jpeg/jpg 的优点：压缩比高、画质保存好 </li>
<li>jpeg/jpg 的使用场景：大图、色彩丰富的图<br></li>
<li>jpeg/jpg 的缺点：纹理、边缘锯齿</li>
</ul>

<p><a href="https://github.com/imagemin/imagemin">jpeg/jpg 优化工具 https://github.com/imagemin/imagemin</a></p>

<p><strong>PNG</strong></p>

<ul>
<li>PNG 的优点：做透明背景<br></li>
<li>PNG 的使用场景：logo</li>
<li>PNG 缺陷：保留了很好的线条、纹理、边缘等细腻,所以体积较大</li>
</ul>

<p><a href="https://github.com/imagemin/imagemin-pngquant">PNG 图片优化工具</a></p>

<p>65%~80%</p>

<p><strong>WebP</strong></p>

<ul>
<li>WebP 的优点：跟 png 同样的质量，但压缩比率高</li>
<li>支持 WebP 的浏览器，兼容性不是很好<br></li>
</ul>

<h2 id="load">图片加载优化-load【突破大型网站图片加载的瓶颈】</h2>

<p><strong>图片的懒加载</strong></p>

<ul>
<li>原生的图片懒加载方案 <code>&lt;img loading=&quot;lazy&quot;&gt;</code><br></li>
<li>第三方图片懒加载方案<br></li>
<li>verlok/lazyload</li>
<li>yall.js</li>
<li>Blazy</li>
</ul>

<p><a href="https://github.com/Aljullu/react-lazy-load-image-component">https://github.com/Aljullu/react-lazy-load-image-component</a></p>

<p><strong>使用渐进式图片</strong></p>

<ul>
<li>baseline JPEG : 图片加载一行显示一行</li>
<li>progressive JPEG: 图片逐渐变清楚,低像素到高像素【用户体验更好】</li>
</ul>

<p><strong>渐进式图片的解决方案</strong></p>

<ul>
<li>progressive-image<br></li>
<li>libjpeg<br></li>
<li>jpeg-recompress<br></li>
<li>ImageMagick<br></li>
<li>jpegtran<br></li>
<li>imagemin</li>
</ul>

<p><strong>使用响应式图片</strong></p>

<ul>
<li>srcset 属性的使用<br></li>
<li>sizes 属性的使用<br></li>
<li>picture 的使用<br></li>
</ul>

<h2 id="font-family">字体优化-font-family【千万不可忽略】</h2>

<p><strong>什么是 FOIT 和 FOUT</strong></p>

<ul>
<li>字体未下载完成时，浏览器隐藏或自动降级，导致字体闪烁<br></li>
<li>Flash Of Invisible Text<br></li>
<li>Flash Of UNstyled Text<br></li>
</ul>

<p><strong>使用 font-display【推荐】</strong></p>

<ul>
<li>auto<br></li>
<li>swap【尽早用默认字体展示出来，新字体下载完了替换，】<br></li>
<li>optional【100ms下载时间内，一旦浏览器做出选择，不会再替换】【手机端使用，推荐】<br></li>
<li>block【3s内不显示，再使用默认字体，字体下载成功后再替换】<br></li>
<li>fallback【block的优化;100ms内不显示，再使用默认字体，字体下载成功后再替换】【推荐】</li>
</ul>
<div class="highlight"><pre><code class="language-css" data-lang="css"><span class="k">@font--face</span> <span class="p">{</span>
    <span class="nl">font-family</span><span class="p">:</span> <span class="p">;</span>
    <span class="nl">font-style</span><span class="p">:</span> <span class="nb">normal</span><span class="p">;</span>
    <span class="nl">font-weight</span><span class="p">:</span> <span class="m">400</span><span class="p">;</span>
    <span class="py">font-display</span><span class="p">:</span> <span class="n">ballback</span>
    <span class="n">src</span><span class="p">:</span> <span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>使用 AJAX + Base64【图推荐】</strong></p>

<ul>
<li>解决兼容性问题<br></li>
<li>缺点：缓存问题</li>
</ul>

<h1 id="6-six-webpack">第6章 构建优化-six(揭开webpack性能优化的内幕)</h1>

<h2 id="webpack-webpack">webpack 的优化配置【了解这些优化配置才敢说会用webpack】 </h2>

<p><strong>Tree-shaking</strong></p>

<ul>
<li>上下文未用到的代码（dead code）<br></li>
<li>基于 ES6 import export<br></li>
<li>package.json 中配置 sideEffects<br></li>
<li>注意 Babel 默认配置的影响<br></li>
</ul>

<p><strong>JS 压缩</strong></p>

<ul>
<li>webpack 4 后引入 uglifyjs-webpack-plugin<br></li>
<li>支持 ES6 替换为 terser-webpack-plugin<br></li>
<li>减小 JS 文件体积<br></li>
</ul>

<p><strong>作用域提升</strong></p>

<ul>
<li>代码体积减小<br></li>
<li>提高执行效率<br></li>
<li>同样注意 babel 的 modules 配置<br></li>
</ul>

<p><strong>babel7 优化配置</strong></p>

<ul>
<li>在需要的地方引入 pofyfill 【useBuiltIns: usage】 </li>
<li>辅助函数的按需引入【&quot;@babel/plugin-transform-runtime&quot;】<br></li>
<li>根据目标浏览器按需转换代码<br></li>
</ul>

<h2 id="webpack-dependency">webpack 的依赖优化-dependency【小改动，大作用】</h2>

<p><strong>noParse</strong></p>

<ul>
<li>提高构建速度<br></li>
<li>直接通知 webpack 忽略较大的库<br></li>
<li>被忽略的库不能有 import 、require、define 的引入方式<br></li>
</ul>

<p><strong>DllPlugin</strong></p>

<ul>
<li>避免打包时对不变的库重复构建<br></li>
<li>提高构建速度<br></li>
</ul>

<h2 id="webpack-splitting">基于 webpack 的代码拆分-splitting【让网站按需加载】</h2>

<p><strong>code splitting 代码拆分做什么</strong></p>

<ul>
<li>把单个 bundle 文件拆分成若干小 bundles/chunks<br></li>
<li>缩短首屏加载时间<br></li>
</ul>

<p><strong>webpack 代码拆分的方法</strong></p>

<ul>
<li>手工定义入口<br></li>
<li>splitChunds 提取公有代码，拆分业务代码与第三方库<br></li>
</ul>

<h2 id="webpack-minification">手把手教你做 webpack 的资源压缩-minification</h2>

<p><strong>基于 webpack 的资源压缩（minification）</strong></p>

<ul>
<li>Terser 压缩 JS<br></li>
<li>mini-css-extract-plugin 压缩 CSS<br></li>
<li>HtmlWebpackPlugin-minify 压缩 HTML<br></li>
</ul>

<h2 id="webpack-cache">基于 webpack 的持久化缓存-cache</h2>

<p><strong>持久化缓存方案</strong></p>

<ul>
<li>每个打包的资源文件有唯一的 hash 值<br></li>
<li>修改后只有受影响的文件 hash 变化<br></li>
<li>充分利用浏览器缓存【推荐 contenthash】<br></li>
</ul>

<h2 id="webpack-stats">基于 webpack 的应用大小监测与分析-stats</h2>

<p><strong>检测与分析</strong></p>

<ul>
<li>stats 分析与可视化图<br></li>
<li>webpack-bundle-analyzer 进行体积分析<br></li>
<li>speed-measure-webpack-plugin 速度分析<br></li>
</ul>

<p><a href="https://alexkuz.github.io/webpack-chart/">Webpack Chart</a></p>

<p>source-map-explorer</p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="s2">"scripts"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nt">"analyze"</span><span class="p">:</span><span class="w"> </span><span class="s2">"source-map-explorer 'build/*.js'"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<h1 id="7-seven">第7章 传输加载优化-seven（前沿技术解决高访问量网站性能优化问题）</h1>

<h2 id="gzip">启用压缩 Gzip【必会的传输压缩方案】</h2>

<p><strong>Gzip</strong></p>

<ul>
<li>对传输资源进行体积压缩，可高达 90%<br></li>
<li>如何配置 Nginx 启动 Gzip<br></li>
</ul>

<h2 id="keep-alive">启用 Keep Alive【通过一个参数提速连接】</h2>

<p>http1.1 默认开启 Keep Aliv</p>

<p>Network -&gt; Headers</p>

<p>Connection: keep-alive</p>

<p>nginx 配置文件中</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">#</span> <span class="nx">keepalive_timeout</span>  <span class="mi">0</span><span class="p">;</span>
<span class="nx">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>  <span class="c1">// 超过多长时间关闭连接</span>
<span class="nx">keepalive_requests</span>  <span class="mi">100</span><span class="p">;</span>  <span class="c1">// 一直持续连接的次数</span>
</code></pre></div>
<p><strong>Keep Alive</strong></p>

<ul>
<li>一个持久的TCP连接，节省了连接创建时间<br></li>
<li>Nginx 默认开启 keep alive<br></li>
</ul>

<h2 id="http-http">HTTP 资源缓存【必会的HTTP缓存方法】</h2>

<p><strong>HTTP 缓存</strong></p>

<p>提高重复访问时资源加载的速度</p>

<ul>
<li>Cache-Control/Expires<br></li>
<li>Last-Modified + if-Modified-Since<br></li>
<li>Etag + If-None-Match</li>
</ul>

<h2 id="service-workers">一次性理解 Service workers 技术，给网站提速</h2>

<p><strong>Service Workers 作用</strong></p>

<ul>
<li>加速重复访问<br></li>
<li>离线支持<br></li>
</ul>

<p><strong>Service Works 注意</strong></p>

<ul>
<li>延长了首屏时间，但页面总加载时间减少<br></li>
<li>兼容性<br></li>
<li>只能在 localhost 或 https 下使用<br></li>
</ul>

<h2 id="http-2">HTTP 2 的性能提升</h2>

<p><strong>HTTP 2的性能提升</strong></p>

<ul>
<li>二进制传输<br></li>
<li>请求响应多路复用<br></li>
<li>server push<br></li>
</ul>

<p><strong>浏览器页面不安全的时候</strong></p>

<p>直接在页面输入<code>thisisunsafe</code>可以绕过</p>

<p><strong>搭建 HTTP2 服务</strong></p>

<ul>
<li>HTTPS<br></li>
<li>适合较高的请求量<br></li>
</ul>

<h2 id="ssr">用流行的 SSR 技术给前端减负</h2>

<p><strong>SSR 的好处</strong></p>

<ul>
<li>加速首屏加载<br></li>
<li>更好的 SEO<br></li>
</ul>

<h1 id="8-eight">第8章 前沿优化解决方案-eight</h1>

<h2 id="svg">拯救移动端图标 SVG【拯救移动端图标】</h2>

<p><strong>从 PNG 到 IconFont</strong></p>

<p><strong>优点</strong></p>

<ul>
<li>多个图标 -- &gt; 一套字体，减少获取时的请求数量和体积<br></li>
<li>矢量图标，可伸缩<br></li>
<li>直接通过 CSS 修改样式（颜色，大小）<br></li>
</ul>

<p><strong>缺点</strong></p>

<ul>
<li>只有一种颜色<br></li>
<li>搜索引擎优化不友好<br></li>
<li>要用就需要引入一整套</li>
</ul>

<p><strong>从 IconFont 到 SVG</strong></p>

<p>优点</p>

<ul>
<li>保持了图片的能力，支持多色彩<br></li>
<li>独立的矢量图形<br></li>
<li>XML 语法，搜索引擎 SEO 和无障碍读屏软件读取<br></li>
</ul>

<h2 id="flexbox">使用 Flexbox 优化布局（上）</h2>

<p><strong>Flexbox 的优势</strong></p>

<ul>
<li>更高效的实现方案<br></li>
<li>容器有能力决定子元素的大小，顺序，对其，间隔等<br></li>
<li>双向布局<br></li>
</ul>

<p><strong>Flexbox 的使用</strong></p>

<ul>
<li>Flex container 容器<br></li>
<li>Flex items 元素<br></li>
</ul>

<h2 id="preload">优化资源加载的顺序-preload【给资源设置优先级】</h2>

<p><strong>资源优先级</strong></p>

<ul>
<li>浏览器默认安排资源优先加载优先级<br></li>
<li>使用 preload, prefetch 调整优先级<br></li>
</ul>

<p><strong>preload, prefetch 使用场景</strong></p>

<ul>
<li>preload: 提前加载较晚出现，但对当前页面非常重要的资源<br></li>
<li>prefetch: 提前加载后继路由需要的资源，优先级低【当前页面资源加载完了之后才 prefetch】<br></li>
</ul>

<p><strong>preload 示例</strong></p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"preload"</span> <span class="na">href=</span><span class="s">"img/.svg"</span> <span class="na">as=</span><span class="s">"image"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
</code></pre></div><div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">".css"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"preload"</span> <span class="na">href=</span><span class="s">".woff2"</span> <span class="na">as=</span><span class="s">"font"</span> <span class="na">type=</span><span class="s">"font/woff2"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
</code></pre></div>
<p><strong>prefetch 示例</strong></p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">".css"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"prefetch"</span> <span class="na">href=</span><span class="s">".css"</span> <span class="na">as=</span><span class="s">"style"</span> <span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
</code></pre></div>
<h2 id="ssr">预渲染页面-SSR【提前完成任务的意义】</h2>

<p><strong>预渲染的作用</strong></p>

<ul>
<li>大型单页应用的性能瓶颈：JS下载+解析+执行<br></li>
<li>SSR 的主要问题：牺牲 TTFB 来补救 First Paint；实现复杂<br></li>
<li>pre-rendering 打包时提前渲染页面，没有服务器参与<br></li>
</ul>

<p><strong>使用 react-snap</strong></p>

<ul>
<li>配置 postbuild<br></li>
<li>使用 ReactDOM.hydrate()<br></li>
<li>首屏内联样式，避免明显的 FOUC（样式闪动）<br></li>
</ul>

<h2 id="windowing">Windowing 提高列表性能【开源节流，用什么画什么】</h2>

<p>Windowing（窗口化）提高列表性能</p>

<p>react-window 插件</p>

<p><strong>windowing 的作用</strong></p>

<ul>
<li>加载大列表、大表单的每一行严重影响性能<br></li>
<li>lazy loading 仍然会让 DOM 变得过大<br></li>
<li>windowing 只渲染可见的行，渲染和滚动的性能都会提升<br></li>
</ul>

<p><strong>使用 react-window</strong></p>

<ul>
<li>配置一个一维列表 List<br></li>
<li>配置一个二维列表 Grid<br></li>
<li>配置滚动到指定元素<br></li>
</ul>

<h2 id="placeholder">使用骨架组件减少布局移动-Placeholder【论占位置的重要性】</h2>

<p>使用骨架组件减少布局移动（layout shift）</p>

<p><strong>Skeleton/Placeholder 的作用</strong></p>

<ul>
<li>占位<br></li>
<li>提升用户感知性能<br></li>
</ul>

<p><strong>react-placerholder</strong></p>

<ul>
<li>预置的 placeholders<br></li>
<li>自定义 placeholder<br></li>
</ul>

<h1 id="9-nine">第9章 性能优化问题面试指南-nine</h1>

<h2 id="web-amp">Web加载&amp;渲染基本原理</h2>

<p><strong>从输入URL 到页面加载显示完成都发生了什么？</strong>  </p>

<p><em>网络线程</em></p>

<p>DNS 查找 IP -&gt; 如果是https 需要建立TLS 连接 -&gt; 设置UA等信息，发送 GET 请求 -&gt; web server 上的应用处理请求 -&gt; 读取response，分析数据类型 -&gt; 安全检查 -&gt; 通知 UI 数据准备就绪  </p>

<p><em>渲染线程</em></p>

<p>解析文本，构建 DOM<br>
边解析 DOM 边加载子资源<br><br>
JS 阻塞解析 async/defer  </p>

<p>解析 CSS ，计算 computed styles<br>
构造布局树 &amp; 大小</p>

<h2 id="first-screen">首屏加载优化-First screen</h2>

<p><strong>什么是首屏加载？怎么优化？</strong></p>

<p><strong>测量指标</strong></p>

<p>First Contentful Paint (FCP)【让用户知道访问的请求成功了，0~2s】</p>

<p>Largest Contentful Paint (LCP)【网站有没有用，0~2.5s】</p>

<p>Time to Interactive (TTI)【什么时候用户可以交互，0~3.8s】</p>

<p><strong>❶ 资源体积太大？</strong></p>

<ul>
<li>资源压缩，<br></li>
<li>传输压缩，<br></li>
<li>代码拆分，<br></li>
<li>tree shaking，<br></li>
<li>HTTP2，<br></li>
<li>缓存<br></li>
</ul>

<p><strong>❷ 首页内容太多？</strong></p>

<ul>
<li>路由/组件/内容 lazy-loading,<br></li>
<li>预渲染/SSR,<br></li>
<li>首屏 Inline CSS<br></li>
</ul>

<p><strong>❸ 加载顺序不合适</strong></p>

<p>prefetch, preload</p>

<h2 id="javascript">JavaScript 内存管理</h2>

<p><strong>JS 是怎样管理内存的？什么情况会造成内存泄露？</strong></p>

<ul>
<li>内存泄露严重影响性能<br></li>
<li>高级语言 != 不需要管理内存<br></li>
</ul>

<p>变量创建时自动分配内存，不使用时“自动”释放内存-GC</p>

<ul>
<li>内存释放的主要问题是如何确定不再需要使用的内存<br></li>
<li><p>所有的GC都是近似实现，只能通过判断变量是否还能再次访问到  </p></li>
<li><p>局部变量，函数执行完，没有闭包引用，就会被标记回收  </p></li>
<li><p>全局变量，直到浏览器卸载页面时释放  </p></li>
</ul>

<p><strong>GC 实现机制</strong></p>

<ul>
<li>引用计数 - 无法解决循环引用的问题<br></li>
<li>标记清除【常用】</li>
</ul>

<p><strong>如何避免内存泄露</strong></p>

<ul>
<li>避免意外的全局变量产生<br></li>
<li>避免反复运行引发大量闭包<br></li>
<li>避免脱离的 DOM 元素<br></li>
</ul>
  
	</div>
	<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <!--
  <%- list_categories(item.categories, {
      show_count: false,
      class: 'article-category',
      style: 'none',
      separator: '►'
  }) %>
  -->
  
  <a class="article-category-link" href="/categories/#other">other</a>
  
</div>


  <div class="article-tags">
  <!--
  <% var tags = [];
    item.tags.forEach(function(tag){
      tags.push('<a href="' + config.root + tag.path + '">' + tag.name + '</a>');
    }); %>-->
  <span></span> <!--<%- tags.join('') %>-->
  
  
  <a href="/tags/#Interview">Interview</a>
  
  <a href="/tags/#imooc">imooc</a>
  
  <a href="/tags/#optimize">optimize</a>
  
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="/other/2020/12/02/muke-performance-optimization" data-title="慕课网-前端性能优化企业级解决方案 6大角度+大厂视野实现项目全面优化 | 彭友谊的博客" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>   
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/other/2020/08/29/muke-project-process" title="慕课网-前端框架及项目面试 聚焦Vue/React/Webpack - 第12章 项目流程">
  <strong>上一篇：</strong><br/>
  <span>
  慕课网-前端框架及项目面试 聚焦Vue/React/Webpack - 第12章 项目流程</span>
</a>
</div>


</nav>

	
<!--  -->
</div>  





      
      
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside toc-content">
 
 <!--<%- toc(item.content) %>-->
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/#Editor" title="Editor">Editor<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/#HTTP" title="HTTP">HTTP<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/#Framework" title="Framework">Framework<sup>43</sup></a></li>
		  
		
		  
			<li><a href="/categories/#Tool" title="Tool">Tool<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/#Command-Line" title="Command-Line">Command-Line<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/#JS" title="JS">JS<sup>86</sup></a></li>
		  
		
		  
			<li><a href="/categories/#CSS" title="CSS">CSS<sup>23</sup></a></li>
		  
		
		  
			<li><a href="/categories/#HTML" title="HTML">HTML<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/#other" title="other">other<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/#markdown" title="markdown">markdown<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#mac" title="mac">mac<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/#apache" title="apache">apache<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#vue" title="vue">vue<sup>32</sup></a></li>
			
		
			
				<li><a href="/tags/#handlebars" title="handlebars">handlebars<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#webpack" title="webpack">webpack<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/#design-pattern" title="design-pattern">design-pattern<sup>15</sup></a></li>
			
		
			
				<li><a href="/tags/#react" title="react">react<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/#requirejs" title="requirejs">requirejs<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#seajs" title="seajs">seajs<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#shell" title="shell">shell<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#ES6" title="ES6">ES6<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/#Interview" title="Interview">Interview<sup>49</sup></a></li>
			
		
			
				<li><a href="/tags/#JS-Basic" title="JS-Basic">JS-Basic<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/#layout" title="layout">layout<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/#standard" title="standard">standard<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/#CSS-Basic" title="CSS-Basic">CSS-Basic<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/#DOM" title="DOM">DOM<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/#optimize" title="optimize">optimize<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/#JS-Function" title="JS-Function">JS-Function<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/#BOM" title="BOM">BOM<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/#RegExp" title="RegExp">RegExp<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#jQuery" title="jQuery">jQuery<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#HTTP" title="HTTP">HTTP<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/#security" title="security">security<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/#algorithm" title="algorithm">algorithm<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/#Command-Line" title="Command-Line">Command-Line<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#imooc" title="imooc">imooc<sup>34</sup></a></li>
			
		
			
				<li><a href="/tags/#Tool" title="Tool">Tool<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#Module" title="Module">Module<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#animation" title="animation">animation<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/#Sass" title="Sass">Sass<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#windows" title="windows">windows<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/#node" title="node">node<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/#GCIP" title="GCIP">GCIP<sup>18</sup></a></li>
			
		
			
				<li><a href="/tags/#CSS-basic" title="CSS-basic">CSS-basic<sup>3</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            <a href="https://developer.mozilla.org/zh-CN/" target="_blank" title="MDN web docs">MDN web docs</a>
          </li>
        
          <li>
            <a href="https://leohxj.gitbooks.io/front-end-database/content/" target="_blank" title="前端工程师手册">前端工程师手册</a>
          </li>
        
          <li>
            <a href="http://www.bootcdn.cn/" target="_blank" title="BootCDN">BootCDN</a>
          </li>
        
          <li>
            <a href="https://cdnjs.com/" target="_blank" title="cdnjs">cdnjs</a>
          </li>
        
    </ul>
</div>

  



</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Make a little progress every day. <br/>
			stronger and powerful.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/pengyouyi" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
	<!--
			<%  Array.prototype.S=String.fromCharCode(2);
			  Array.prototype.in_array=function(e){
    			var r=new RegExp(this.S+e+this.S);
    			return (r.test(this.S+this.join(this.S)+this.S));
				};
				var cc = new Array('by','by-nc','by-nc-nd','by-nc-sa','by-nd','by-sa','zero'); %>
		<% if (cc.in_array(theme.creative_commons) ) { %>
				<div class="cc-license">
          <a href="http://creativecommons.org/licenses/<%= theme.creative_commons %>/4.0" class="cc-opacity" target="_blank">
            <img src="<%- config.root %>img/cc-<%= theme.creative_commons %>.svg" alt="Creative Commons" />
          </a>
        </div>
    <% } %>
				-->

		<p class="copyright">
		Powered by <a href="http://jekyllrb.com" target="_blank" title="jekyll">jekyll</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="about" target="_blank" title="pengyouyi">pengyouyi</a>
		
		
		</p>
</div>


</footer>
    <script src="/assets/js/jquery-2.0.3.min.js"></script>
<script src="/assets/js/jquery.imagesloaded.min.js"></script>
<script src="/assets/js/gallery.js"></script>
<script src="/assets/js/jquery.qrcode-0.12.0.min.js"></script>
<script src="/assets/js/toc.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
      
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.toc-content').toc();
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>



<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#nothing"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
/*
  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      //$('.hoverqrcode').hide();
  });
  */
});   
</script>





<!--

-->




<link rel="stylesheet" href="/assets/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/assets/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      if ($(this).hasClass('emoji')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>


<!-- Analytics Begin -->



<!--<script type="text/javascript">-->
<!--var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");-->
<!--document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F130eaab551382bf609b702558cf803a0' type='text/javascript'%3E%3C/script%3E"));-->
<!--</script>-->

<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?130eaab551382bf609b702558cf803a0";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>




<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/assets/img/scrollup.png"/></a>
	</div>
	<script src="/assets/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->
  </body>
</html>

